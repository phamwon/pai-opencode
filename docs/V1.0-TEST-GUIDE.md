# PAI-OpenCode v1.0 Fresh Install Test Guide

**Datum:** 2026-01-24
**Ziel:** Vollständige Validierung aller v1.0 Features auf neuem macOS Account

---

## Voraussetzungen

1. **Neuer macOS Benutzeraccount** erstellen (z.B. "opencode-test")
2. **Keine bestehende .opencode/ Installation**
3. **Terminal öffnen** als neuer Benutzer

---

## Installation

```bash
# 1. Repository klonen
git clone https://github.com/Steffen025/pai-opencode.git
cd pai-opencode

# 2. Installer ausführen
./install.sh

# 3. Terminal neu starten (für Aliases)
exec $SHELL

# 4. OpenCode starten
opencode
```

---

## Test 1: Context Injection (CORE Loading)

**Was getestet wird:** LoadContext Hook - CORE Skill wird beim Start injiziert

### Schritte:
1. OpenCode starten: `opencode`
2. Eingeben: `Was weißt du über PAI?`

### Erwartetes Ergebnis:
- PAI-relevante Antwort mit Bezug zu "Personal AI Infrastructure"
- Keine Fehlermeldungen im Log

### Verifikation:
```bash
cat /tmp/pai-opencode-debug.log | grep "Context injected"
# Sollte zeigen: "Context injected successfully"
```

---

## Test 2: Security Validation

**Was getestet wird:** SecurityValidator Hook - Gefährliche Commands werden geblockt

### Schritte:
1. In OpenCode eingeben: `Führe aus: rm -rf /`

### Erwartetes Ergebnis:
- Command wird **GEBLOCKT**
- Fehlermeldung: `[PAI Security] Blocked: ...`

### Verifikation:
```bash
cat /tmp/pai-opencode-debug.log | grep "BLOCKED"
# Sollte Security-Block Entry zeigen
```

---

## Test 3: Work Session Tracking (AutoWorkCreation)

**Was getestet wird:** Work-Tracker erstellt automatisch MEMORY/WORK/ Sessions

### Schritte:
1. Neuer Prompt: `Erkläre mir TypeScript Generics`
2. Warte auf Antwort
3. Prüfe Dateisystem

### Erwartetes Ergebnis:
```bash
ls ~/.opencode/MEMORY/WORK/2026-01/
# Sollte einen neuen Ordner zeigen: {timestamp}_erklaere-mir-typescript/
# Mit: META.yaml, ISC.json, THREAD.md
```

### Verifikation:
```bash
cat ~/.opencode/MEMORY/WORK/2026-01/*/META.yaml
# Sollte zeigen: status: IN_PROGRESS, title: "..."
```

---

## Test 4: Rating Capture (ExplicitRatingCapture)

**Was getestet wird:** User-Ratings werden zu MEMORY/LEARNING/SIGNALS/ gespeichert

### Schritte:
1. Nach einer Antwort eingeben: `8`
2. Oder: `7 - könnte besser sein`

### Erwartetes Ergebnis:
```bash
cat ~/.opencode/MEMORY/LEARNING/SIGNALS/ratings.jsonl
# Sollte JSON-Entry mit score: 8 zeigen
```

### Verifikation für niedrige Ratings (< 7):
```bash
ls ~/.opencode/MEMORY/LEARNING/RESPONSE/2026-01/
# Sollte Learning-File zeigen wenn Rating < 7 war
```

---

## Test 5: Agent Output Capture (AgentOutputCapture)

**Was getestet wird:** Subagent (Task Tool) Outputs werden gespeichert

### Schritte:
1. Eingeben: `Finde alle TypeScript Dateien im Projekt mit einem Agent`
2. Warte bis Agent fertig ist

### Erwartetes Ergebnis:
```bash
ls ~/.opencode/MEMORY/RESEARCH/2026-01/
# Sollte zeigen: AGENT-{type}_{timestamp}_{slug}.md
```

### Verifikation:
```bash
cat ~/.opencode/MEMORY/RESEARCH/2026-01/AGENT-*.md | head -20
# Sollte Agent-Output mit Description und Summary zeigen
```

---

## Test 6: Learning Extraction (WorkCompletionLearning)

**Was getestet wird:** Bei Session-Ende werden Learnings extrahiert

### Schritte:
1. In OpenCode arbeiten (mindestens 2-3 Prompts)
2. Session beenden (Ctrl+C oder /exit)

### Erwartetes Ergebnis:
```bash
ls ~/.opencode/MEMORY/LEARNING/*/2026-01/
# Könnte Learning-Files zeigen (je nach Session-Inhalt)
```

### Verifikation:
```bash
cat /tmp/pai-opencode-debug.log | grep "Learning"
# Sollte zeigen: "Extracted N learnings from work session"
```

---

## Test 7: Skill Restore Workaround

**Was getestet wird:** OpenCode's Skill-Normalization wird rückgängig gemacht

### Schritte:
1. OpenCode starten und beenden
2. Git-Status prüfen

### Erwartetes Ergebnis:
```bash
cd ~/.opencode && git status
# Sollte KEINE modifizierten SKILL.md Dateien zeigen
```

### Verifikation:
```bash
cat /tmp/pai-opencode-debug.log | grep "Skill restore"
# Sollte zeigen: "Skill restore: N files restored" (oder 0 wenn keine modifiziert)
```

---

## Test 8: MEMORY Struktur

**Was getestet wird:** Alle MEMORY Subdirectories existieren

### Prüfung:
```bash
ls -la ~/.opencode/MEMORY/
```

### Erwartete Struktur:
```
MEMORY/
├── LEARNING/
│   ├── ALGORITHM/
│   ├── CODE/
│   ├── GENERAL/
│   ├── RESPONSE/
│   ├── SIGNALS/
│   └── SYSTEM/
├── RESEARCH/
│   └── 2026-01/
├── STATE/
├── WORK/
│   └── 2026-01/
└── (weitere nach Bedarf)
```

---

## Test 9: Debug Log

**Was getestet wird:** Plugin-Logging funktioniert korrekt

### Prüfung:
```bash
cat /tmp/pai-opencode-debug.log
```

### Erwartete Log-Einträge:
- `=== PAI-OpenCode Plugin v1.0.0 Loaded ===`
- `Working directory: /path/to/pwd`
- `Hooks: Context, Security, Work, Ratings, Agents, Learning`
- `Injecting context...`
- `Context injected successfully`
- Verschiedene `Tool before/after` Einträge

---

## Testprotokoll

| Test | Status | Notizen |
|------|--------|---------|
| 1. Context Injection | [ ] PASS / [ ] FAIL | |
| 2. Security Validation | [ ] PASS / [ ] FAIL | |
| 3. Work Session | [ ] PASS / [ ] FAIL | |
| 4. Rating Capture | [ ] PASS / [ ] FAIL | |
| 5. Agent Capture | [ ] PASS / [ ] FAIL | |
| 6. Learning Extraction | [ ] PASS / [ ] FAIL | |
| 7. Skill Restore | [ ] PASS / [ ] FAIL | |
| 8. MEMORY Struktur | [ ] PASS / [ ] FAIL | |
| 9. Debug Log | [ ] PASS / [ ] FAIL | |

---

## Troubleshooting

### Plugin lädt nicht
```bash
# Prüfe ob Plugin existiert
ls ~/.opencode/plugins/pai-unified.ts

# Prüfe OpenCode Config
cat ~/.opencode/settings.json | grep plugins
```

### Keine Log-Einträge
```bash
# Prüfe Permissions
ls -la /tmp/pai-opencode-debug.log

# Erstelle manuell
touch /tmp/pai-opencode-debug.log
chmod 666 /tmp/pai-opencode-debug.log
```

### MEMORY nicht erstellt
```bash
# Erstelle manuell
mkdir -p ~/.opencode/MEMORY/{LEARNING/{ALGORITHM,CODE,GENERAL,RESPONSE,SIGNALS,SYSTEM},RESEARCH,STATE,WORK}
```

---

## Nach erfolgreichem Test

1. **Dokumentiere Ergebnisse** in Testprotokoll
2. **Lösche Test-Account** wenn nicht mehr benötigt
3. **Erstelle v1.0 Release** wenn alle Tests PASS

---

*Test Guide erstellt: 2026-01-24*
*PAI-OpenCode v1.0.0*
